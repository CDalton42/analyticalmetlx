<div class="lift:surround?with=unstyledDefaultWebMeTL;at=content">
	<script data-lift="with-resource-id" src="static/js/carota-debug.js"></script>
	<script data-lift="with-resource-id" src="static/js/historyRenderer.js"></script>
	<script data-lift="with-resource-id" src="static/js/InteractableCanvas.js"></script>
	<script src="static/js/stable/Tween.js"></script>
	<script type="text/javascript">
		var mockHistory = {
			type:"history",
			inks:{
				"2":{
					type:"ink",
					timestamp:2,
					identity:"2",
					thickness:5,
					points:[50,50,50,100,100,50,100,50,50,50,50,50],
					color:["000000",255],
					isHighlighter:false,
					target:"presentationSpace",
					author:"test",
					privacy:"PUBLIC"
				}
			},
			highlighters:[],
			texts:{
				"1":{
					type:"text",
					timestamp:1,
					identity:"1",
					x:20,
					y:20,
					width:100,
					height:30,
					color:["000000",255],
					text:"what about this",
					font:"arial",
					size:12,
					weight:"regular",
					style:"normal",
					target:"presentationSpace",
					author:"test",
					privacy:"PUBLIC"
				}
			},
			multiWordTexts:{},
		 	images:{
				/*
				"3":{
					type:"image",
					timestamp:3,
					identity:"3",
					x:100,
					y:100,
					width:160,
					height:120,
					target:"presentationSpace",
					author:"test",
					privacy:"PUBLIC"
				}
				*/
			},
			videos:{}
		}
		$(function(){
			var newCanvas = createInteractiveCanvas($("#board"));
			newCanvas.onStanza = function(s){
				sendStanza(s);
			};
			newCanvas.onSelectionChanged(function(selected){
				MeTLBus.call("selectionChanged",[selected]);
			});
			newCanvas.onModeChanged(function(mode){
				MeTLBus.call("modeChanged",[mode]);
			});
			newCanvas.onStatistic(function(category,time,success,exception){
				//console.log("onStatistic",category,time,success,exception);
				if ("HealthChecker" in window){
					HealthChecker.addMeasure(category,time,success);
				}
			});
			newCanvas.onError(function(exception,caller,params){
				console.log("InteractiveCanvasException",caller,exception,params);
			});
			newCanvas.onPreRenderItem(function(item,ctx){
				//console.log("preRender",item,ctx);
				//return item.type == "ink";
				return true;
			});
			newCanvas.onPostRenderItem(function(item,ctx){
				//console.log("postRender",item,ctx);
			});
			window.InteractiveCanvas = newCanvas;
			newCanvas.onStanzaAvailable(function(stanza){
				console.log("stanza created:",stanza);
				stanza.author = "testUser";
				stanza.privacy = "PUBLIC";
				stanza.target = "presentationSpace";
				stanza.slide = "thisSlide";
				newCanvas.addStanza(stanza);
			});
			newCanvas.setHistory(mockHistory);
			newCanvas.setDimensions(DeviceConfiguration.getMeasurements());
			newCanvas.setMode(_.find(newCanvas.getAvailableModes(),function(m){return m.name == "draw";}));
			MeTLBus.subscribe("beforeWorkQueueResume","test",function(){});
			MeTLBus.subscribe("afterWorkQueuePause","test",function(){});
			MeTLBus.subscribe("layoutUpdated","test",function(dims){
				newCanvas.setDimensions(dims);
			});
		});
	</script>
	<div class="lift:embed?what=_canvas"></div>
</div>
