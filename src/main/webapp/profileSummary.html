<!--<div class="lift:surround?with=unstyledDefaultWebMeTL;at=content">-->
<div class="lift:surround?with=flexible;at=content">
  <script data-lift="with-resource-id" src="static/js/stable/sprintf-0.7-beta1.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/clipboard.min.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/lodash.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/jquery.ui.widget.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/jquery.iframe-transport.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/jquery.fileupload.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/d3.v4.min.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/d3.layout.cloud.js"></script>
  <link data-lift="with-resource-id" rel="stylesheet" href="static/css/jAlert.css"></link>
  <script data-lift="with-resource-id" src="static/js/stable/jAlert.min.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/jAlert-functions.min.js"></script>
  <script data-lift="with-resource-id" src="static/js/stable/jsgrid.min.js" data-lift="with-resource-id"></script>
  <link data-lift="with-resource-id" rel="stylesheet" href="static/css/jsgrid.min.css"></link>
  <link data-lift="with-resource-id" rel="stylesheet" href="static/css/jsgrid-theme.min.css"></link>
  <script data-lift="with-resource-id" src="static/js/stable/moment.min.js"></script>
  <script data-lift="with-resource-id" src="static/js/collections.js"></script>
	<script data-lift="with-resource-id" src="static/js/profile.js"></script>
	<script type="text/javascript">
		var ProfileSummaryUI = (function(){
			var sessionTemplate = undefined;
			var	profileAttributeContainer = undefined;
			var profileAttributeTemplate = undefined;
			var currentProfile = {};
			var profileUpdated = function(p){
				console.log("received profile update",p);
				currentProfile = p;
				reRenderUI();
			};
			var reRenderUI = function(){
				$("#profileName").text(currentProfile.name);
				$("#profileId").text(currentProfile.id);
				if (currentProfile !== undefined && "attributes" in currentProfile){ 
					var imageSrc = currentProfile.attributes.avatarUrl;
					if (imageSrc === undefined || imageSrc == ""){
						imageSrc = sprintf("http://api.adorable.io/avatars/285/%s.png",currentProfile.id); 
					}
					$("#profileImage").attr("src",imageSrc);
				}

				profileAttributeContainer.html(_.map(currentProfile.attributes,function(value,key){
					var attrElem = profileAttributeTemplate.clone();
					attrElem.find(".profileAttributeName").text(key);
					attrElem.find(".profileAttributeValue").text(value);
					return attrElem;
				}));
			}
			MeTLBus.subscribe("receiveProfile","profileSummary.html",profileUpdated);
			$(function(){
				profileAttributeContainer = $("#profileAttributeContainer");
				profileAttributeTemplate = profileAttributeContainer.find(".profileAttribute").clone();
				profileAttributeContainer.empty();
				reRenderUI();
			});
			MeTLBus.subscribe("receiveThemes","profile",function(themes){
				console.log("themes:",themes);
			});
			MeTLBus.subscribe("receiveAttendances","profile",function(attendances){
				console.log("attendances:",attendances);
			});
			MeTLBus.subscribe("receiveConversations","profile",function(conversations){
				console.log("conversations:",conversations);
			});
			return {
				getProfile:function(){return currentProfile;}
			};
		})();
	</script>
	<style>
#profileContainer {
	background:white;
}
#profileImage {
	width:320px;
}
	</style>
	<div id="profileContainer">
		<div id="profileName"></div>
		<div id="profileId"></div>
		<img id="profileImage"></img>
		<div id="profileAttributeContainer">
			<div class="profileAttribute">
				<span class="profileAttributeName"></span>: <span class="profileAttributeValue"></span>
			</div>
		</div>
 	</div>
	<div class="lift:Metl.specificProfileSummary"></div>
</div>

