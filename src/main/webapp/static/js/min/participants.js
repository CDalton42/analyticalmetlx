var Participants=function(){var k={},g={},f={},h=function(){try{var e=_.map(f,function(b){var a=k.clone(),c=sprintf("participant_%s",b.name);a.find(".followLabel").attr("for",c);a.find(".followValue").attr("id",c).prop("checked",b.following).on("change",function(){b.following=$(this).is(":checked");blit()});a.find(".user").text(b.name);a.find(".attendanceCount").text(_.size(b.attendances));a.find(".inksCount").text(b.inks);a.find(".highlightersCount").text(b.highlighters);a.find(".imagesCount").text(b.images);
a.find(".textsCount").text(b.texts);a.find(".quizSubmissionsCount").text(b.submissions);a.find(".quizResponsesCount").text(b.quizResponses);return a});g.html(e)}catch(b){console.log("participantRender failed:",b,f)}},n=function(){showBackstage("participants");updateActiveMenu(this);h()},l=function(){Conversations.shouldModifyConversation()?($("#menuParticipants").click(n),$("#menuParticipants").show()):($("#menuParticipants").unbind("click"),$("#menuParticipants").hide())},m=function(){l()};$(function(){g=
$("#participantsListingContainer");k=g.find(".participation").clone();g.empty();l()});Progress.stanzaReceived.participants=function(e){if("type"in e&&"author"in e){var b=e.author,a=f[b];switch(e.type){case "ink":a.inks+=1;break;case "image":a.images+=1;break;case "highlighter":a.highlighters+=1;break;case "text":a.texts+=1;break;case "submission":a.submissions+=1;break;case "quizResponse":a.quizResponses+=1}f[b]=a}h()};Progress.historyReceived.participants=function(e){var b={};_.each(_.groupBy(e.attendances,
"author"),function(a){var c=a[0].author;b[c]={name:c,attendances:a,inks:0,highlighters:0,texts:0,images:0,quizResponses:0,submissions:0,following:!0}});_.each(_.groupBy(e.inks,"author"),function(a){var c=a[0].author,d=b[c];d.inks+=_.size(a);b[c]=d});_.each(_.groupBy(e.highlighters,"author"),function(a){var c=a[0].author,d=b[c];d.highlighters+=_.size(a);b[c]=d});_.each(_.groupBy(e.texts,"author"),function(a){var c=a[0].author,d=b[c];d.texts+=_.size(a);b[c]=d});_.each(_.groupBy(e.images,"author"),function(a){var c=
a[0].author,d=b[c];d.images+=_.size(a);b[c]=d});f=b;h()};Progress.conversationDetailsReceived.participants=m;Progress.newConversationDetailsReceived.participants=m;return{getParticipants:function(){return Conversations.shouldModifyConversation()?f:{}}}}();
