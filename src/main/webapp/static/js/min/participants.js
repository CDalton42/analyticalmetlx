var Participants=function(){var k={},f={};participants={};var g={inks:0,highlighters:0,texts:{},images:0,quizResponses:0,submissions:0,following:!0},l=function(b){return _.reduce(b.words,function(c,a,b){return c+a.text.length},0)},h=function(){try{var b=_.map(participants,function(c){var a=k.clone(),b=sprintf("participant_%s",c.name),d=a.find(".followLabel").attr("for",b);Conversations.shouldModifyConversation()&&d.text(c.name);a.find(".followValue").attr("id",b).prop("checked",c.following).on("change",
function(){c.following=$(this).is(":checked");blit()});a.find(".attendanceCount").text(_.size(c.attendances));a.find(".inksCount").text(c.inks);a.find(".highlightersCount").text(c.highlighters);a.find(".imagesCount").text(c.images);a.find(".textsCount").text(_.reduce(c.texts,function(a,c){return a+c},0));a.find(".quizSubmissionsCount").text(c.submissions);a.find(".quizResponsesCount").text(c.quizResponses);return a});f.html(b)}catch(c){console.log("participantRender failed:",c,participants)}},p=function(){showBackstage("participants");
updateActiveMenu(this);h()},m=function(){Conversations.shouldModifyConversation()?($("#menuParticipants").click(p),$("#menuParticipants").show()):($("#menuParticipants").unbind("click"),$("#menuParticipants").hide())},n=function(){m()};$(function(){f=$("#participantsListingContainer").find("tbody");k=f.find(".participation").clone();f.empty();m()});Progress.stanzaReceived.participants=function(b){if("type"in b&&"author"in b){var c=b.author;if(!(c in participants)){var a=_.clone(g);a.name=c;participants[c]=
a}a=participants[c];switch(b.type){case "ink":a.inks+=1;break;case "image":a.images+=1;break;case "highlighter":a.highlighters+=1;break;case "multiWordText":a.texts[b.identity]=l(b);break;case "submission":a.submissions+=1;break;case "quizResponse":a.quizResponses+=1}participants[c]=a}h()};Progress.historyReceived.participants=function(b){var c={},a=function(a){return c[a]||_.cloneDeep(g)};_.each(_.groupBy(b.attendances,"author"),function(b){var d=b[0].author,e=a(g);e.name=d;e.attendances=b;c[d]=
e});_.each(_.groupBy(b.inks,"author"),function(b,d){var e=a(d);e.inks+=_.size(b);c[d]=e});_.each(_.groupBy(b.highlighters,"author"),function(b,d){var e=a(d);e.highlighters+=_.size(b);c[d]=e});_.each(_.groupBy(b.images,"author"),function(b,d){var e=a(d);e.images+=_.size(b);c[d]=e});_.each(_.groupBy(b.multiWordTexts,"author"),function(b,d){a(d);_.each(b,function(a){var b=l(a);c[d].texts[a.identity]=b})});_.each(_.groupBy(b.quizResponses,"author"),function(b,d){var e=a(d);e.quizResponses+=_.size(b);
c[d]=e});participants=c;h()};Progress.conversationDetailsReceived.participants=n;Progress.newConversationDetailsReceived.participants=n;return{getParticipants:function(){return Conversations.shouldModifyConversation()?participants:{}},code:function(b){return _.keys(participants).indexOf(b)}}}();
