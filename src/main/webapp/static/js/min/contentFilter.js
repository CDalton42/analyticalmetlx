var ContentFilter=function(){var c=[],m={id:"owner",name:"owner",filterStanza:function(a){return"author"in a&&a.author==Conversations.getCurrentConversation().author},enabled:!0},n={id:"myPrivate",name:"My private content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PRIVATE"==a.privacy},enabled:!0},p={id:"myPublic",name:"My public content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PUBLIC"==
a.privacy},enabled:!0},q={id:"peer",name:"My peers' content",filterStanza:function(a){return"author"in a&&a.author!=Conversations.getCurrentConversation().author&&a.author!=UserSettings.getUsername()},enabled:!0},r=function(a){return{id:a.id,name:a.name,filterStanza:function(b){var e="members"in a?a.members:[];return"author"in b&&_.includes(e,b.author)},type:"group",enabled:!0}},t=function(a){var b=Participants.getParticipants()[a.author];return b&&!b.following||c.length&&a.audiences&&a.audiences.length&&
!_.some(a.audiences,function(a){return _.includes(c,a.name)||_.includes(c,a)})?!1:_.some(d,function(b){return b.enabled&&b.filterStanza(a)})},g=function(a){return function(b,e,c,d,g,u,f,h){t(b)&&a(b,e,c,d,g,u,f,h)}},d=[],f={},l={};$(function(){var a=drawText,b=drawImage,e=drawMultiwordText;drawInk=g(drawInk);drawText=g(a);drawImage=g(b);drawMultiwordText=g(e);$("#menuContentFilter").on("click",function(){showBackstage("contentFilter");updateActiveMenu(this)});f=$("#contentFilterListing");l=f.find(".contentFilterItem").clone();
f.empty()});var v=function(a){var b=l.clone(),e=b.find(".contentFilterCheckbox"),c=b.find(".contentFilterCheckboxLabel"),d=b.find(".contentFilterCheckboxLabelText"),g=sprintf("contentFilter_%s",a.id);if(Conversations.getCurrentSlide()){var f=_.find(Conversations.getCurrentGroups(),function(b){return b.id==a.id});f?d.text(sprintf("Group %s: %s",f.title,_.join(f.members,","))):d.text(a.name)}else d.text(a.name);c.attr("for",g);e.prop("checked",a.enabled);e.attr("id",g);e.on("change",function(){a.enabled=
e.is(":checked");k();blit()});return b},k=function(){f.html(_.map(d,v))},h=function(){var a=Conversations.getCurrentSlide(),b=[n,p];Conversations.isAuthor()||(b=b.concat(m));Conversations.getCurrentGroups().length||(b=b.concat(q));d=b.concat(a?_.map(Conversations.isAuthor()?Conversations.getCurrentGroups():Conversations.getCurrentGroup(),r):[]);k();blit()};Progress.currentSlideJidReceived.ContentFilter=function(){c=[];h()};Progress.onConversationJoin.ContentFilter=function(){c=[];h()};Progress.afterJoiningSlide.ContentFilter=
function(){c=[];h()};Progress.conversationDetailsReceived.ContentFilter=h;return{getFilters:function(){return d},setFilter:function(a,b){_.each(d,function(c){c.id==a&&(c.enabled=b)});k();blit()},getAudiences:function(){return c},setAudience:function(a){c=[a]},clearAudiences:function(){c=[]}}}();
