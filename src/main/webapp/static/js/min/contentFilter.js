var ContentFilter=function(){var d=[],m={id:"owner",name:"owner",filterStanza:function(a){return"author"in a&&a.author==Conversations.getCurrentConversation().author},enabled:!0},n={id:"myPrivate",name:"My private content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PRIVATE"==a.privacy},enabled:!0},p={id:"myPublic",name:"My public content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PUBLIC"==
a.privacy},enabled:!0},q={id:"peer",name:"My peers' content",filterStanza:function(a){return"author"in a&&a.author!=Conversations.getCurrentConversation().author&&a.author!=UserSettings.getUsername()},enabled:!0},r=function(a){return{id:a.id,name:a.name,filterStanza:function(b){var c="members"in a?a.members:[];return"author"in b&&_.includes(c,b.author)},type:"group",enabled:!0}},t=function(a){var b=Participants.getParticipants()[a.author];return b&&!b.following||d.length&&a.audiences&&a.audiences.length&&
!_.some(a.audiences,function(a){return _.includes(d,a.name)})?!1:_.some(e,function(b){return b.enabled&&b.filterStanza(a)})},g=function(a){return function(b,c,d,e,g,u,f,h){t(b)&&a(b,c,d,e,g,u,f,h)}},e=[],f={},l={};$(function(){var a=drawText,b=drawImage,c=drawMultiwordText;drawInk=g(drawInk);drawText=g(a);drawImage=g(b);drawMultiwordText=g(c);$("#menuContentFilter").on("click",function(){showBackstage("contentFilter");updateActiveMenu(this)});f=$("#contentFilterListing");l=f.find(".contentFilterItem").clone();
f.empty()});var v=function(a){var b=l.clone(),c=b.find(".contentFilterCheckbox"),d=b.find(".contentFilterCheckboxLabel"),e=b.find(".contentFilterCheckboxLabelText"),g=sprintf("contentFilter_%s",a.id);if(Conversations.getCurrentSlide()){var f=_.find(Conversations.getCurrentGroups(),function(b){return b.id==a.id});f?e.text(sprintf("Group %s: %s",f.title,_.join(f.members,","))):e.text(a.name)}else e.text(a.name);d.attr("for",g);c.prop("checked",a.enabled);c.attr("id",g);c.on("change",function(){a.enabled=
c.is(":checked");k();blit()});return b},k=function(){f.html(_.map(e,v))},h=function(){var a=Conversations.getCurrentSlide(),b=[n,p];Conversations.isAuthor()||(b=b.concat(m));Conversations.getCurrentGroups().length||(b=b.concat(q));e=b.concat(a?_.map(Conversations.isAuthor()?Conversations.getCurrentGroups():Conversations.getCurrentGroup(),r):[]);k();blit()};Progress.currentSlideJidReceived.ContentFilter=function(){d=[];h()};Progress.onConversationJoin.ContentFilter=function(){d=[];h()};Progress.afterJoiningSlide.ContentFilter=
function(){d=[];h()};Progress.conversationDetailsReceived.ContentFilter=h;return{getFilters:function(){return e},setFilter:function(a,b){_.each(e,function(c){c.id==a&&(c.enabled=b)});k();blit()},getAudiences:function(){return d},setAudience:function(a){d=[a]},clearAudiences:function(){d=[]}}}();
