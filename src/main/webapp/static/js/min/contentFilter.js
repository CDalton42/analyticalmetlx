var ContentFilter=function(){var l={id:"owner",name:"owner",filterStanza:function(a){return"author"in a&&a.author==Conversations.getCurrentConversation().author},enabled:!0},f={id:"myPrivate",name:"My private content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PRIVATE"==a.privacy},enabled:!0},e={id:"myPublic",name:"My public content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PUBLIC"==a.privacy},
enabled:!0},m={id:"peer",name:"My peers' content",filterStanza:function(a){return"author"in a&&a.author!=Conversations.getCurrentConversation().author&&a.author!=UserSettings.getUsername()},enabled:!0},n=function(a){return{id:a.id,name:a.name,filterStanza:function(b){var c="members"in a?a.members:[];return"author"in b&&_.contains(c,b.author)},enabled:!0}},r=function(a){var b=Participants.getParticipants()[a.author];return b&&!b.following?!1:_.some(d,function(b){return"enabled"in b&&1==b.enabled?b.filterStanza(a):
!1})},g=function(a){return function(b,c,d,f,e,g,h,k){r(b)&&a(b,c,d,f,e,g,h,k)}},d=[],h={},p={};$(function(){var a=drawText,b=drawImage,c=drawMultiwordText;drawInk=g(drawInk);drawText=g(a);drawImage=g(b);drawMultiwordText=g(c);$("#menuContentFilter").on("click",function(){showBackstage("contentFilter");updateActiveMenu(this)});h=$("#contentFilterListing");p=h.find(".contentFilterItem").clone();h.empty()});var t=function(a){var b=p.clone(),c=b.find(".contentFilterCheckbox"),d=b.find(".contentFilterCheckboxLabel"),
f=b.find(".contentFilterCheckboxLabelText"),e=sprintf("contentFilter_%s",a.id);f.text(a.name);d.attr("for",e);c.prop("checked",a.enabled);c.attr("id",e);c.on("change",function(){a.enabled=c.is(":checked");k();blit()});return b},k=function(){h.html(_.map(d,t))},u=function(a){d=Conversations.isAuthor()?_.concat([f,e],_.map(a,n)):_.concat([l,f,e],_.map(_.filter(a,function(a){return _.contains(a.members,UserSettings.getUsername())}),n));blit()},q=function(){var a=Conversations.getCurrentSlide();void 0!=
a&&"groupSet"in a?u(a.groupSet.groups):(d=Conversations.isAuthor()?[f,e,m]:[l,f,e,m],blit());k()};Progress.conversationDetailsReceived.ContentFilter=q;Progress.onConversationJoin.ContentFilter=q;return{getFilters:function(){return d},setFilter:function(a,b){_.each(d,function(c){c.id==a&&(c.enabled=b)});k();blit()}}}();
