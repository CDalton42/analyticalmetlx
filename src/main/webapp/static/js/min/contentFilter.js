var ContentFilter=function(){var c=[],p={id:"owner",name:"owner",filterStanza:function(a){return"author"in a&&a.author==Conversations.getCurrentConversation().author},enabled:!0},q={id:"myPrivate",name:"My private content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PRIVATE"==a.privacy},enabled:!0},r={id:"myPublic",name:"My public content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PUBLIC"==
a.privacy},enabled:!0},t={id:"peer",name:"My peers' content",filterStanza:function(a){return"author"in a&&a.author!=Conversations.getCurrentConversation().author&&a.author!=UserSettings.getUsername()},enabled:!0},u=function(a){return{id:a.id,name:a.name,filterStanza:function(b){var e="members"in a?a.members:[];return"author"in b&&_.includes(e,b.author)},type:"group",enabled:!0}},l=function(a){return c.length&&a.audiences&&a.audiences.length&&!_.some(a.audiences,function(a){return _.includes(c,a.name)||
_.includes(c,a)})},m=function(a){var b=Participants.getParticipants()[a.author];return b&&!b.following||l(a)?!1:_.some(d,function(b){return b.enabled&&b.filterStanza(a)})},g=function(a){return function(b,e,c,d,g,v,f,h){m(b)&&a(b,e,c,d,g,v,f,h)}},d=[],f={},n={};$(function(){var a=drawText,b=drawImage,e=drawMultiwordText;drawInk=g(drawInk);drawText=g(a);drawImage=g(b);drawMultiwordText=g(e);$("#menuContentFilter").on("click",function(){showBackstage("contentFilter");updateActiveMenu(this)});f=$("#contentFilterListing");
n=f.find(".contentFilterItem").clone();f.empty()});var w=function(a){var b=n.clone(),e=b.find(".contentFilterCheckbox"),c=b.find(".contentFilterCheckboxLabel"),d=b.find(".contentFilterCheckboxLabelText"),g=sprintf("contentFilter_%s",a.id);if(Conversations.getCurrentSlide()){var f=_.find(Conversations.getCurrentGroups(),function(b){return b.id==a.id});f?d.text(sprintf("Group %s: %s",f.title,_.join(f.members,","))):d.text(a.name)}else d.text(a.name);c.attr("for",g);e.prop("checked",a.enabled);e.attr("id",
g);e.on("change",function(){a.enabled=e.is(":checked");k();blit()});return b},k=function(){f.html(_.map(d,w))},h=function(){var a=Conversations.getCurrentSlide(),b=[q,r];Conversations.isAuthor()||(b=b.concat(p));Conversations.getCurrentGroups().length||(b=b.concat(t));d=b.concat(a?_.map(Conversations.isAuthor()?Conversations.getCurrentGroups():Conversations.getCurrentGroup(),u):[]);k();blit()};Progress.currentSlideJidReceived.ContentFilter=function(){c=[];h()};Progress.onConversationJoin.ContentFilter=
function(){c=[];h()};Progress.afterJoiningSlide.ContentFilter=function(){c=[];h()};Progress.conversationDetailsReceived.ContentFilter=h;return{getFilters:function(){return d},setFilter:function(a,b){_.each(d,function(c){c.id==a&&(c.enabled=b)});k();blit()},getAudiences:function(){return c},setAudience:function(a){c=[a]},clearAudiences:function(){c=[]},isIsolatedFrom:l,exposes:m}}();
